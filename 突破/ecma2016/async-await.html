<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>

let ajaxGetPromise = (url)=>{
    return new Promise((resolve,reject)=>{
        $.ajax({
            url:url,
            dataType:"json"
        }).done((data)=>{
            resolve(data)
        }).fail((xhr,status,err)=>{
            reject(err)
        })
    })
}

//async await
async function genTen(){
    let [page,pageSize] =[1,30]
    for(;page<=10;page++){
        let p = ajaxGetPromise(`http://learning-api.mafengshe.com/news?page=${page}&pageSize=${pageSize}`)
        
        try{
            console.log(p)
            console.log(await p)//通过await关键字，将p一个promise对获得值，相当于yield关键字
        } catch(err){
            console.log(err)
        }//异常捕获，可以捕获genten函数里面的异常也可以捕获promise里面的异步操作的rejected状态异常           
    }
    return "end"
}

// genTen()//异步函数调用可以直接调用，不需要再去包装next方法，async await已经包装好了
genTen().then(data=>{
    console.log(data)//调用异步函数，并在调用结束后，将return值打印出来
})//genten也是一个promise的对象，可以使用then方法，

console.log(await genTen())//报错，虽然await关键字可以将promise对象获得值，但是和yield同理，不可以在async函数以外使用await关键字

try{
    genTen()
}catch(err){
    console.log(err)
}//在调用时异常捕获，会出错，无法处理异常，因为异步函数是一个promise对象，对于promise对象的异常捕获方法应该是使用.catch方法

//正确的在调用异步函数时捕获异常写法：
genTen().catch(err=>{
    console.log(err)
})

</script>
