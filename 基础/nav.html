<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nav导航条</title>
    <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js"></script> -->
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <style>
        body {
            margin: 0px;
            background-color: rgb(40, 40, 62);
        }
        .top {
            height: 20px;
        }
        .nav{
            width: 100%;
            height: 55px;
            color: white;
            background-color: transparent;
            transition: background 0.5s;
            position: fixed;
        }
        .fixed {          
            position: fixed;/*实现当滚动条滚动时，nav不动*/
            top: 0;
            left: 0;
        }
        .nav:hover {
            color: black;
            background-color: #ffe502;
        }
        .nav.show {
            color: black;
            background-color: #ffe502;
        }
        .container{
            max-width: 1040px;/*适应不同屏幕*/
            margin: 0 auto;/*居中*/
        }
        .li2 {
            margin: 5px 10px 8px;/*图标*/
        }
        .link{
            margin: 15px 22px 0px;
            font-weight: bold;
            position: relative;
        }
        .fl{
            float:left;
        }
        .fr{
            float: right;
        }
        /* .item1 {
            position: relative;
            z-index: 2;
        } */
        .list {
            list-style: none;/*去掉列表每项前面的圆点*/
            /* display:none; */
            width: 95px;
            height: 0px;
            background-color: #ffe502;
            position: absolute;
            top: 40px;
            left: -20px;
            z-index: -1;
            overflow: hidden;
            margin:0;
            padding: 0;  
            /* opacity: 0; */ /*通过透明度设置渐变*/
            transition: all 0.3s;/*渐变*/
        }
        li {
            margin-left: 5px;
        }
        .link:hover{
            color: rgb(102, 78, 48);
        }
        .link:hover .list{
            /*display: block;*/   /*transition对display无效*/
            /* opacity: 1; */
            height: 90px;
            background-color: #ffe502;
            /* animation: move 0.5s ;  */  
        }
        @keyframes move {
            0% {
                top: 10px;
                /* height: 0px; */
            }
            100% {
                top: 40px;
                /* height: 55px; */
            }
        }/*无效，不使用动画*/
        .main {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }
        .body {
            position: absolute;
            width: 1000px;
            min-height: 1200px;
            margin: 50px 40px;
            background-color: rgb(196, 195, 195);
            /* height: 3700px; */
            z-index: -3;
        }
        .a {
        height: 450px;
        }
        .img{
        height: 400px;
        width: 550px;
        background: green;
        }
        .item {
            position: absolute;
            width: 200px;
            margin: 5px;
            transition: all 1s;
        }
        .water-fall {
            position: relative;/*脱离了文档流,父元素的高度没有被这部分撑起来*/
            top: 1900px;
            z-index: -2;
            margin: 0 auto;
            left: 0;
            right: 0;
            width: 90%;
        }

        .type1 {
            background-color: Cyan;
            height: 250px;
        }

        .type2 {
            background-color: Coral;
            height: 450px;
        }

        .type3 {
            background-color: Indigo;
            height: 350px;
        }
        .backtop {
            position: fixed;
            right: 130px;
            bottom: 100px;
            height: 50px;
            width: 50px;
            text-align: center;
            /* line-height: 50px; */
            border-radius: 5px;
            background-color: rgb(223, 223, 223);
            color: rgb(113, 113, 113);
            font-size: 50px;
            cursor: pointer;
            visibility: hidden;
            opacity: 0;
            transition: all 0.5s;
        }
        .backtop.show {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="top" data-test="2"></div>
    <nav class="nav" id="nav">
        <div class="container">
            <img class="li2 fl" src="./test1/images/circle.png"/>
            <div class="link fl">码蜂社</div>
            <div class="link fl">首页</div>
            <div class="link fl">
                <div class="item1">前端</div>
                <div class="list">
                    <li >基础班</li>
                    <li>闯关班</li>
                    <li>Web闯关班</li>
                    <li>Web闯关班</li>
                </div>
            </div>
            <div class="link fl">社区
                <div class="list">
                    <li>论坛</li>
                    <li>闯关任务</li>
                    <li>论坛</li>
                    <li>闯关任务</li>
                </div>
            </div>
            <div class="link fl">关于我们</div>

            <div class="link fr">登录</div>
            <div class="link fr">注册</div>
        </div>
    </nav>
    <div class="container">
        <div class="main">
            <div class="body">
                <div class="a"></div>
                <div class="a"></div>
                <img class="img" data-src="./test1/images/cat.jpg" alt="">
                <div class="a"></div>
            </div>
        </div>
    </div>

    <div class="water-fall">
        <div class="item type1">1</div>
        <div class="item type2">2</div>
        <div class="item type3">3</div>
        <div class="item type2">4</div>
        <div class="item type3">5</div>
        <div class="item type1">6</div>
        <div class="item type2">7</div>
        <div class="item type3">8</div>
        <div class="item type2">9</div>
        <div class="item type3">10</div>
        <div class="item type1">11</div>
        <div class="item type3">12</div>
        <div class="item type1">13</div>
        <div class="item type3">14</div>
        <div class="item type1">15</div>
        <div class="item type2">16</div>
        <div class="item type1">17</div>
        <div class="item type2">18</div>           
    </div>
    <div class="backtop">^</div>
    <script>
        var nav = document.getElementById("nav")
        var $node = $(".backtop") 
        // var node = document.querySelector(".backtop")

        $node[0].addEventListener('click',function(){
                window.scrollTo(0,0);
            })//回到顶部

        // $node.click(function(){
        //     window.scrollTo(0,0);
        // })

        //图片懒加载————获取图片是否在屏幕可视框内：
        // function isShow($img) {
        //     // var windowH = $(window).height();
        //     var windowH = window.innerHeight;
        //     var scrollTop = $(window).scrollTop();
        //     var imgOT = $img.offset().top;
        //     var imgH = $img.height();
        //     return imgOT <= scrollTop + windowH +100 && imgOT + imgH >= scrollTop
        // }

        window.onscroll =  function(){
                var timeId = null
                clearTimeout(timeId)
                timeId = setTimeout(function(){
                    var T = window.scrollY;
                    var H = $(window).height();
                    if(T > 20){
                        nav.classList.add("show")//nav背景颜色变化
                        $("nav").addClass("fixed")//磁铁效果
                    } else{
                        nav.className = "nav"//nav背景颜色变化
                        $("nav").removeClass("fixed")//磁铁效果
                    }
                    if(T > H*0.2){
                        $node.addClass("show")//回到顶部
                    } else{
                        $node.removeClass("show")//回到顶部
                    }
                    //图片懒加载：
                    // if(isShow($('.img'))){
                    //     // $('.img').attr("src", "./test1/images/cat.jpg")
                    //     $('.img').attr("src", $('.img').data("src"))
                    // } 
                    // console.log(isShow($('.img')))
                },100)
            }

        //瀑布流
        function findMinIndex(arr) {
            var minIndex = 0;
            for (var i = 0; i < arr.length; i++) {
                if (arr[i] < arr[minIndex])
                    minIndex = i;
            }
            return minIndex;
        }//寻找各列之中所有元素高度之和的最小者

        function waterFall() {

            var itemWidth = $(".item").outerWidth(true)//true是作为.outerWidth()方法的一个参数传递进去的。它表示是否包括元素的外边距（margin）在内
            var containerWidth = $(".water-fall").width()
            var colNum = Math.floor(containerWidth / itemWidth);
            var heights = [];//各列的高度的数组

            for (var i = 0; i < colNum; i++) {
                heights.push(0)//各列高度初始化为 0
            }

            $(".item").each(function () {
                var col = findMinIndex(heights);
                var ele = $(this)

                ele.css({
                    top: heights[col] + "px",
                    left: col * itemWidth + "px"
                });//将新的元素添加到该列上

                heights[col] += ele.outerHeight(true);//该列高度加上新元素的高度
            })
        }

        waterFall();

        $(window).on("resize",function () {
            waterFall()
        })//事件绑定

        //图片懒加载：
        function LazyImg($node){
            function isShow($node){
                var windowH = window.innerHeight;//屏幕可视窗口高度
                var scrollTop = $(window).scrollTop();//浏览器窗口顶部与文档顶部之间的距离，也就是滚动条滚动的距离
                var imgH = $node.height();//获取元素的尺寸
                var imgOT = $node.offset().top;// 元素距离文档顶的距离
                return imgOT <= windowH+scrollTop && imgH + imgOT >= scrollTop
            }
            
            window.onscroll = function(){
                var timeId = null;
                clearTimeout(timeId);
                timeId = setTimeout(function(){
                    if(isShow($node)){
                    $node.attr("src",$node.data("src"))
                    }
                },100)
            }
        }

        new LazyImg($('.img'))
        
    </script>
</body>
</html>