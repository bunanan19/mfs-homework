<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cookie</title>
    <link rel="stylesheet" href="./iconfont/iconfont.css">
    <style>
        body {
            margin: 0;
        }
        .goods {
            width: 80%;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            position: relative;
            margin: 0 auto;
        }
        .item {
            width: 120px;
            height: 100px;
            background-color: rgb(226, 174, 16);
            border-radius: 5px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            justify-content: end;
        }
        .placehold {
            width: 120px;
            margin: 10px;
        }
        span {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .cnt {
            color: rgb(121, 121, 121);
            align-self: center;
        }
        .add {
            
        }
        .line {
            width: 100%;
            height: 10px;
            background-color: gray;
            position: relative;
            margin: 0;
        }
        .line p {
            height: 40px;
            font-size: 18px;
            line-height: 40px;
            padding-left: 10px;
            border-radius: 20px;
            color: brown;
            margin: 20px;
            position: absolute;
            top: 10px;
            background-color: antiquewhite;
        }
        .line p span {
            font-size: 22px;
        }
        #gouwuche {
            margin-top: 20px;
            margin-left: 180px;
            border: 3px dashed olivedrab;
            width: 900px;
            height: auto;
            padding-bottom: 100px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .additem {
            width: 400px;
            display: flex;
            justify-content: space-between;
        }
        .additem .addcnt {
            font-size: 16px;
            color: rgb(3, 106, 72);
            width: 220px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            background-color: salmon;
            border-radius: 5px;
            margin: 10px;
        }
        .additem .nu {
            font-size: 14px;
            color: rgb(3, 50, 34);
            width: 120px;
            height: 28px;
            text-align: center;
            line-height: 28px;
            border: 2px solid black;
            border-radius: 5px;
            margin: 10px;
        }
        .additem .delete {
            font-size: 14px;
            color: rgb(255, 255, 255);
            width: 60px;
            height: 30px;
            text-align: center;
            background-color: rgb(255, 25, 0);
            border-radius: 5px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="goods">
        <div class="item" >
            <span class="cnt">Aas</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Bdd</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Cvva</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Dvaha</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Eijc</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Fjscv</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Gfewe</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Hafc</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Iss</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="item" >
            <span class="cnt">Jvv</span>
            <button class="add"><span>+</span></button>
        </div>
        <div class="placehold"></div>
        <div class="placehold"></div>
        <div class="placehold"></div>
        <div class="placehold"></div>
        <div class="placehold"></div>
        <div class="placehold"></div>
        <div class="placehold"></div>
    </div>

    <div class="line"><p><span class="iconfont icon-a-jiagou2x"></span> 购物车：</p></div>

    <div id="gouwuche">
        <!-- <div class="additem" id="0">
            <span class="addcnt" >Aas</span>
            <span class="nu">X20</span>
            <button class="delete">删除</button>
        </div>        -->
    </div>

    <script>
        var btns = document.querySelectorAll(".goods>.item>.add");
        var goodsName = document.querySelectorAll(".goods>.item>.cnt");
        var oGouwuche = document.getElementById("gouwuche");
        var items = []; // 存储购物车中的物品

        // 从 localStorage 中恢复购物车内容，刷新后购物车数据根据localStorage恢复原数据
        var buyStorage = localStorage.getItem('buy');
        if (buyStorage) {
            items = JSON.parse(buyStorage);//将字符串转为数组对象
            for (let i = 0; i < items.length; i++) {
                for(j=0 ;j<goodsName.length;j++){
                    if(goodsName[j].innerHTML == items[i].name){
                        index = j;
                        break;
                    }
                }
                var dom = document.createElement("div");
                dom.setAttribute("class", "additem");
                dom.setAttribute("id", index);
                var html = '<span class="addcnt">' + items[i].name + '</span>' +
                    '<span class="nu">x' + items[i].quantity + '</span>' +
                    '<button class="delete">删除</button>';
                dom.innerHTML = html;
                oGouwuche.appendChild(dom);
            }
        }
        
        //对每一个物品添加点击，定义事件处理函数
        for (let i = 0; i < btns.length; i++){
            btns[i].addEventListener("click",function(){
                var addItem = document.querySelectorAll("#gouwuche>.additem>.addcnt");
                // let addArry = Array.from(addItem);
                // var addName = addArry.map(node => node.innerHTML)
                // var index = addName.indexOf(goodsName[i].innerHTML);
                var index = items.findIndex(n => n.name === goodsName[i].innerHTML)
                if(index === -1){//判断当前购物车中是否已加购相同物品
                    var dom = document.createElement("div");
                    dom.setAttribute("class","additem");
                    dom.setAttribute("id",i) 
                    var newItem = {
                        name: goodsName[i].innerHTML,
                        quantity: 1
                    };
                    items.push(newItem);//将新加入的物品写入购物车items
                    
                    var html = '<span class="addcnt">'+goodsName[i].innerHTML+'</span>'+
                    '<span class="nu">x1</span>'+
                    '<button class="delete">删除</button>'
                    dom.innerHTML = html;
                    oGouwuche.appendChild(dom);//为购物车写入内部html结构
                    
                } else {
                    var item = document.getElementById(i);//根据商品id锁定购物车中的dom元素
                    items[index].quantity +=1 ;//更新数据
                    item.querySelector(".nu").innerHTML = 'x'+items[index].quantity//局部刷新数量，数量+1
                }
                localStorage.setItem('buy', JSON.stringify(items));//购物数据写入缓存
                cik();//为动态生成的元素绑定事件删除
            })
        }
        // 删除按钮事件处理函数
        function cik(){
            var del = document.querySelectorAll(".delete");
            for (var i = 0; i < del.length; i++) {
            del[i].addEventListener("click", function () {
                var dom = this.parentNode;
                oGouwuche.removeChild(dom); // 从DOM中删除对应的商品元素
                var item = dom.querySelector(".addcnt").innerHTML;
                for (var j = 0; j < items.length; j++) {
                    if (items[j].name === item) {
                        items.splice(j, 1); // 从数组中删除对应的商品数据
                        break;
                    }
                }
                localStorage.setItem('buy', JSON.stringify(items)); // 更新localStorage
                });
            }
        }
        cik()//为购物车中的物品添加事件绑定
    </script>
</body>
</html>