# 浏览器存储

在某些情况下，我们需要在浏览器中存储一些数据。不同于普通的JS对象，我们需要存储的数据可以`持久`、`稳定`的存储。

持久和稳定体现在：

- 不会因为页面刷新而丢失数据
- 当页面重新打开时，我们可以获得之前存储的数据
- 同一个域下的网页可以共享数据
- *存储的数据可以让服务器端知晓（这条不是不必要）

购物车就是一个很好的例子，我们希望购物车的数据存储可以满足以上四点。

我们可以通过 Cookie 或者 Web Storage 来实现我们的需求。

## Cookie

### 什么是 Cookie

Cookie 是一些数据, 存储于你电脑上的文本文件中。

当 web 服务器向浏览器发送 web 页面时，在连接关闭后，服务端不会记录用户的信息。

Cookie 的作用就是用于解决 "如何记录客户端的用户信息"

Cookie 以名/值对形式存储，如下所示:

```raw
username=Mark
```

当浏览器从服务器上请求 web 页面时， 属于该页面的 Cookie **会被添加到该请求中**。服务端通过这种方式来获取用户的信息。设置好cookie后刷新页面，在network看见请求，请求的request headers有添加的cookie。

<img src="C:\Users\86153\AppData\Roaming\Typora\typora-user-images\image-20231005115712297.png" alt="image-20231005115712297" style="zoom:80%;" />

### 创建Cookie

JavaScript 可以使用 document.cookie 属性来创建 、读取、及删除 cookie。

JavaScript 中，创建 cookie 如下所示：

```javascript
document.cookie="username=Mark";
```

还可以为 cookie 添加一个过期时间（以 UTC 或 GMT 时间）。默认情况下，cookie 在浏览器关闭时删除：

```javascript
document.cookie="username=Mark; expires=Thu, 18 Dec 2018 12:00:00 GMT";
```

可以使用 path 参数告诉浏览器 cookie 的路径。默认情况下，cookie 属于当前页面。

```javascript
document.cookie="username=Mark; expires=Thu, 18 Dec 2013 12:00:00 GMT; path=/";
//“path=/”使这条cookie对当前域名下的所有文件下都存在
```

### 读取 Cookie

在 JavaScript 中, 可以使用以下代码来读取 cookie：

```javascript
var x = document.cookie;
```

### 修改 Cookie

在 JavaScript 中，修改 cookie 类似于创建 cookie，如下所示：

```javascript
document.cookie="username=Mark2; expires=Thu, 18 Dec 2013 12:00:00 GMT; path=/";
```

### 删除 Cookie

删除 cookie 非常简单。您只需要设置 expires 参数为以前的时间即可，如下所示，设置为 Thu, 01 Jan 1970 00:00:00 GMT:

```javascript
document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT";
```

注意，删除时不必指定 cookie 的值。

### Cookie 字符串

document.cookie 属性看起来像一个普通的文本字符串，但实际上不是。

即使在 document.cookie 中写入一个完整的 cookie 字符串, 重新读取该 cookie 信息时，cookie 信息是以名/值对的形式展示的。

同时当我们设置了新的 cookie，旧的 cookie 不会被覆盖。 新 cookie 将添加到 document.cookie 中，将获得如下所示的数据：

```raw
cookie1=value; cookie2=value;
```

## Web Storage

在没有Web Storage之前，是通过cookie来在客户端存储数据的。但是由于

- 浏览器能存cookie数比较少。如IE8，Firefox,opera每个域可以保存的50个cookie,Safari/WebKit没有限制。一个cookie最多可以存放4096B左右的数据
- 每次请求时，cookie都会存放在请求头中，传输到服务器端。但如果请求头大小超过了限制，服务器会处理不了。

因此cookie不适合大量数据的存储。相比用Web Storage更适合存储大量数据:

- 每个域Chrome，Firefox和Opera是5M，IE是10M。
- 请求时不会带web stroge的内容。

### localStorage 和 sessionStorage

他们都只能读写当前域的数据，区别是，localStorage存储的数据不会过期，sessionStorage存储的数据每次关闭浏览器后都会被清空。

localStorage和sessionStorage的api是一样的。后面的 API 介绍以 localStorage为例

#### 创建和修改

```javascript
/*
* value会被调用 .toString方法转化成字符串。因此，如果要储存的是对象，调用JSON.stringify(obj)来序列化成字符串
*/
localStorage.setItem('key', 'value');
```

#### 读取

```javascript
localStorage.getItem('key');
localStorage.key(index);//localStorage数组中下标是index的key
```

#### 删除

```javascript
localStorage.removeItem('key');//删除某一个localStorage
localStorage.clear();//清空所有localStorage
```

当然，更简便的，我们也可以像访问普通对象一样访问 localStorage

```javascript
// 创建或是修改
localStorage.key = "value"

// 读取
console.log(localStorage.key)

// 删除
delete localStorage.key
```

## 实战：购物车



## 问答题

1. 有哪些浏览器存储？他们各是如何使用的？

   > 1. **Cookie**：Cookie 是一些数据, 存储于你电脑上的文本文件中，一个cookie最多可以存放4096B左右的数据。Cookie 以名/值对形式存储，当浏览器从服务器上请求 web 页面时， 属于该页面的 Cookie **会被添加到该请求中**。服务端通过这种方式来获取用户的信息。
   > 2. **LocalStorage**：存储大小约5M，ocalStorage存储的数据不会过期。它的存储是浏览器本地行为，与服务器没有任何关系，也就是说不会随着http请求发送给服务器；存储形式为key-value形式。
   > 3. **SessionStorage**：SessionStorage不同于localStorage，它不是永久存储，一次会话就过期（关闭浏览器就都会被清空）；SessionStorage的用法和localStorage一样，也是浏览器本地行为。

2. Cookie 对比 Web Storage 有何异同？

   > - 浏览器能存cookie数比较少。如IE8，Firefox,opera每个域可以保存的50个cookie,Safari/WebKit没有限制。一个cookie最多可以存放4096B左右的数据
   > - 每次请求时，cookie都会存放在请求头中，传输到服务器端。但如果请求头大小超过了限制，服务器会处理不了。
   >
   > 因此cookie不适合大量数据的存储。相比用Web Storage更适合存储大量数据:
   >
   > - 每个域Chrome，Firefox和Opera是5M，IE是10M。
   > - 请求时不会带web stroge的内容。

3. 请分析 JavaScript 中的对象与浏览器存储之间的差异

   > 1. **数据类型**：JavaScript 对象是 JavaScript 程序中数据的基本组织形式，它们可以是各种类型，如字符串、数字、布尔值、数组、函数、日期等。而浏览器存储，只能存储字符串类型的数据。
   > 2. **生命周期**：JavaScript 对象在定义后存在的作用域内有效，函数结束后对象就会被销毁，除非使用特定的方式将其保存在其他地方（例如全局变量）。而浏览器存储的数据则会在浏览器关闭后继续存在，除非被用户清除或者由程序主动删除。
   > 3. **访问方式**：JavaScript 对象可以直接通过属性名来访问其属性，也可以通过点符号或者方括号来访问。而浏览器存储的数据需要通过特定的 API（如 window.localStorage 和 window.sessionStorage）进行访问和修改。
   > 4. **存储空间**：JavaScript 对象的存储空间是有限的，由内存管理，当内存不足时，可能会被回收。而浏览器存储的空间则取决于浏览器的设置和用户的硬盘空间。
   > 5. **数据安全性**：JavaScript 对象的数据对于开发者是可见的，因此可能存在安全风险。而浏览器存储的数据对于开发者是不可见的，只有通过特定的 API 可以访问和修改，因此相对更安全。
   > 6. **数据持久性**：JavaScript 对象的数据在页面刷新或者关闭后就会消失，除非使用特定的技术（如 localStorage）进行保存。而浏览器存储的数据则可以持久保存，即使关闭浏览器或者重启电脑，数据仍然存在。

## 代码题

1. 请实现购物车，并有完成如下特性:
   1. 可以添加物品
   2. 可以删除物品
   3. 添加多次相同物品，会在购物车中显示添加输入量
   4. 购物车内容刷新不丢失（可以使用 Cookie 或者 Web Storage 存储）
   5. UI 部分可以自己发挥，不做强制要求